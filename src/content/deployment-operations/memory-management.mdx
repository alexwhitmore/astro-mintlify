---
title: 'Memory Management'
date: '2024-06-28'
description: 'Learn about memory allocation and management in Epic Stack applications deployed on Fly.io.'
draft: false
type: 'deployment-ops'
---

import GroupName from '../../components/docs/GroupName.astro'
import CodeBlock from '../../components/docs/CodeBlock.astro'

<GroupName>Deployment & Operations</GroupName>

# Memory Management

Epic Stack applications are designed to start with efficient memory usage, but understanding and managing memory allocation is crucial for optimal performance and scalability.

## Initial Memory Allocation

By default, Epic Stack apps start with:

- A single instance
- 256MB of memory allocation

While this is a relatively small amount of memory, it's sufficient for getting started with most applications.

## Swap File

To help mitigate memory pressure even at this small scale, Epic Stack allocates a 512MB swap file. This decision is explained in detail in the [memory swap decision document](decisions/010-memory-swap.md).

### Modifying Swap File Size

To modify or increase the swap file size:

1. Locate the `fly.toml` file in your project root.
2. Find the `.swap_size_mb` setting.
3. Adjust the value as needed.

<CodeBlock
  code={`# Example fly.toml
[mounts]
  source="data"
  destination="/data"

[http_service]
internal_port = 8080
force_https = true
auto_stop_machines = true
auto_start_machines = true
min_machines_running = 0
processes = ["app"]

[deploy]
release_command = "node ./other/sentry-create-release"

[build]
dockerfile = "Dockerfile"

# Swap file configuration

[experimental]
command = "/app/start_with_migrations.sh"
auto_rollback = true
entrypoint = "litefs mount"
memory_swap = 512 # Set swap file size in MB
`}
lang="toml"
/>

This configuration is executed before running your app within the `litefs.yml` config.

> **NOTE**: Contributions are welcome to document methods for determining the effectiveness of the swap file for your specific application.

## Increasing VM Memory

To increase the memory allocated to your virtual machine:

1. Use the [`fly scale`](https://fly.io/docs/flyctl/scale-memory/) command.

<CodeBlock code='fly scale memory 1024' lang='bash' />

This command would scale the memory to 1024MB (1GB).

2. You can [learn more about memory sizing in the Fly docs](https://fly.io/docs/machines/guides-examples/machine-sizing).

By understanding and properly managing memory allocation, you can ensure that your Epic Stack application runs efficiently and can scale to meet your needs.

---
import { getCollection } from 'astro:content'
import siteConfig from '../config/site.json'
import DocumentationLayout from '../layouts/DocumentationLayout.astro'
import { generateToc } from '../lib/toc'

export const prerender = true

export async function getStaticPaths() {
  const paths = siteConfig.navigation.flatMap((group) =>
    group.pages.map((page) => ({
      params: { slug: page.url.slice(1) },
      props: { page },
    }))
  )
  return paths
}

const { slug } = Astro.params
const { page } = Astro.props
const doc = await getCollection(
  'getting-started',
  (entry) => entry.slug === slug
)

if (doc.length === 0) {
  return Astro.redirect('/404')
}

const { Content, headings } = await doc[0].render()
const toc = generateToc(headings)
const title = page?.name
---

<DocumentationLayout title={title} toc={toc}>
  <Content />
</DocumentationLayout>
